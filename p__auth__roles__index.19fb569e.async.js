"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[164],{10442:function(je,Q,a){var ae=a(15009),g=a.n(ae),ne=a(99289),c=a.n(ne),se=a(5574),z=a.n(se),te=a(55581),S=a(67294),U=function(ue){var oe=(0,S.useState)([]),Y=z()(oe,2),v=Y[0],y=Y[1],H=function(){var V=c()(g()().mark(function M(){var w;return g()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,(0,te.et)(ue,{pageSize:1e4});case 2:w=b.sent,w.success&&y(w.data);case 4:case"end":return b.stop()}},M)}));return function(){return V.apply(this,arguments)}}();return(0,S.useEffect)(function(){H().catch(console.error)},[]),{items:v,setItems:y}};Q.Z=U},63982:function(je,Q,a){a.r(Q),a.d(Q,{default:function(){return Be}});var ae=a(5574),g=a.n(ae),ne=a(15009),c=a.n(ne),se=a(97857),z=a.n(se),te=a(99289),S=a.n(te),U=a(55581),ge=a(51042),ue=a(6110),oe=a(17992),Y=a(2236),v=a(12578),y=a(2453),H=a(36147),V=a(71577),M=a(67294),w=a(37476),B=a(12029),b=a(96695),Se=a.n(b),ye=a(10442),Te=a(34994),Ce=a(5966),xe=a(14e3),r=a(85893),Oe=function(s){var t,l=s.form,n=s.permissions,u=(0,v.useIntl)(),o=(0,M.useState)([]),T=g()(o,2),e=T[0],E=T[1],J=(0,M.useState)((t=n==null?void 0:n.map(function(F){return"".concat(F.id).concat(F.name)}))!==null&&t!==void 0?t:[]),X=g()(J,2),N=X[0],P=X[1],le=(0,M.useState)([]),K=g()(le,2),q=K[0],L=K[1],ie=(0,M.useState)(!0),G=g()(ie,2),R=G[0],_=G[1],de=(0,ye.Z)("/permissions"),ee=de.items,re=function(f){var j={},A=[],x=Se()(f),$;try{for(x.s();!($=x.n()).done;){var ce,ve,D=$.value,W="".concat(D.permissionGroup.id).concat(D.permissionGroup.name),I=j[W];I||(I={key:W,title:D.permissionGroup.name,children:[]},j[W]=I);var Ke="".concat(D.id).concat(D.name),Ge={key:Ke,title:D.name};if((ce=I.children)===null||ce===void 0||ce.push(Ge),I.children&&((ve=I.children)===null||ve===void 0?void 0:ve.length)>0&&!A.includes(W)&&A.push(W),D.permissionGroup.parent){var me,k="".concat(D.permissionGroup.parent.id).concat(D.permissionGroup.parent.name),Z=j[k];if(Z||(Z={key:k,title:D.permissionGroup.parent.name,children:[]},j[k]=Z),!((me=Z.children)!==null&&me!==void 0&&me.includes(I))){var fe;(fe=Z.children)===null||fe===void 0||fe.push(I),Z.children&&Z.children.length>0&&!A.includes(k)&&A.push(k)}}}}catch(pe){x.e(pe)}finally{x.f()}var _e=Object.values(j).filter(function(pe){return!f.some(function(he){return he.permissionGroup.id+he.permissionGroup.name===pe.key&&he.permissionGroup.parent})});return{treeData:_e,nonLeafKeys:A}},p=re(ee),i=p.treeData,d=p.nonLeafKeys,h=function(f){E(f),_(!1)},C=function(f){var j=new Set(d.map(function($){return $.toString()}));P(f);var A;Array.isArray(f)&&(A=f.filter(function($){return!j.has($.toString())}));var x=A.map(function($){return Number(parseInt($.toString()))});l.setFieldsValue({permissions:x})},m=function(f){L(f)};return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(Te.A.Group,{children:[(0,r.jsx)(Ce.Z,{rules:[{required:!0,message:(0,r.jsx)(v.FormattedMessage,{id:"pages.searchTable.name.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u540D\u79F0"})}],label:u.formatMessage({id:"pages.roles.name",defaultMessage:"\u540D\u79F0"}),width:"md",name:"name"}),(0,r.jsx)(B.Z.Item,{name:"permissions",children:(0,r.jsxs)("div",{children:["\u9009\u62E9\u6743\u9650",(0,r.jsx)(xe.Z,{checkable:!0,onExpand:h,expandedKeys:e,autoExpandParent:R,onCheck:C,checkedKeys:N,onSelect:m,selectedKeys:q,treeData:i})]})})]})})},Me=Oe,De=function(s){var t=s.open,l=s.onOpenChange,n=s.onFinish,u=(0,v.useIntl)(),o=B.Z.useForm(),T=g()(o,1),e=T[0];return(0,r.jsx)(w.Y,{form:e,title:u.formatMessage({id:"pages.searchTable.createForm.newRole",defaultMessage:"\u65B0\u5EFA\u89D2\u8272"}),width:"70%",open:t,onOpenChange:l,onFinish:n,children:(0,r.jsx)(Me,{form:e})})},Ee=De,Pe=a(31991),Re=a(85265),Ae=function(s){var t=s.onClose,l=s.open,n=s.currentRow,u=s.columns;return(0,r.jsx)(Re.Z,{width:"70%",open:l,onClose:t,closable:!1,children:(n==null?void 0:n.name)&&(0,r.jsx)(Pe.vY,{column:2,title:n==null?void 0:n.name,request:S()(c()().mark(function o(){return c()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:n||{}});case 1:case"end":return e.stop()}},o)})),params:{id:n==null?void 0:n.name},columns:u})})},$e=Ae,Ie=a(96365),be=function(s){var t=s.updateModalOpen,l=s.onCancel,n=s.onSubmit,u=s.values,o=(0,v.useIntl)(),T=B.Z.useForm(),e=g()(T,1),E=e[0];return(0,M.useEffect)(function(){t?E.setFieldsValue(u):E.resetFields()},[t,E,u]),(0,r.jsxs)(w.Y,{form:E,title:o.formatMessage({id:"pages.searchTable.createForm.newUser",defaultMessage:"\u65B0\u5EFA\u7528\u6237"}),width:"70%",modalProps:{destroyOnClose:!0,maskClosable:!1},open:t,onOpenChange:l,onFinish:n,initialValues:z()({},u),children:[(0,r.jsx)(Me,{permissions:u.permissions,form:E}),(0,r.jsx)(B.Z.Item,{name:"id",label:!1,children:(0,r.jsx)(Ie.Z,{type:"hidden"})})]})},Ze=be,Ue=function(){var O=S()(c()().mark(function s(t){var l,n,u,o;return c()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=y.ZP.loading("\u6B63\u5728\u6DFB\u52A0"),e.prev=1,e.next=4,(0,U.$)("/roles",z()({},t));case 4:return l(),y.ZP.success("Added successfully"),e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(1),l(),y.ZP.error((n=e.t0===null||e.t0===void 0||(u=e.t0.response)===null||u===void 0||(o=u.data)===null||o===void 0?void 0:o.message)!==null&&n!==void 0?n:"Adding failed, please try again!"),e.abrupt("return",!1);case 14:case"end":return e.stop()}},s,null,[[1,9]])}));return function(t){return O.apply(this,arguments)}}(),we=function(){var O=S()(c()().mark(function s(t){var l,n,u,o;return c()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=y.ZP.loading("\u6B63\u5728\u66F4\u65B0"),e.prev=1,e.next=4,(0,U.$G)("/roles/".concat(t.id),t);case 4:return l(),y.ZP.success("\u66F4\u65B0\u6210\u529F"),e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(1),l(),y.ZP.error((n=e.t0===null||e.t0===void 0||(u=e.t0.response)===null||u===void 0||(o=u.data)===null||o===void 0?void 0:o.message)!==null&&n!==void 0?n:"\u66F4\u65B0\u5931\u8D25,\u8BF7\u91CD\u8BD5"),e.abrupt("return",!1);case 14:case"end":return e.stop()}},s,null,[[1,9]])}));return function(t){return O.apply(this,arguments)}}(),Fe=function(){var O=S()(c()().mark(function s(t){var l,n,u,o;return c()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l=y.ZP.loading("\u6B63\u5728\u5220\u9664"),t){e.next=3;break}return e.abrupt("return",!0);case 3:return e.prev=3,e.next=6,(0,U.cl)("/roles",{ids:t});case 6:return l(),y.ZP.success("Deleted successfully and will refresh soon"),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(3),l(),y.ZP.error((n=e.t0===null||e.t0===void 0||(u=e.t0.response)===null||u===void 0||(o=u.data)===null||o===void 0?void 0:o.message)!==null&&n!==void 0?n:"Delete failed, please try again"),e.abrupt("return",!1);case 16:case"end":return e.stop()}},s,null,[[3,11]])}));return function(t){return O.apply(this,arguments)}}(),Le=function(){var s=(0,M.useState)(!1),t=g()(s,2),l=t[0],n=t[1],u=(0,M.useState)(!1),o=g()(u,2),T=o[0],e=o[1],E=(0,M.useState)(!1),J=g()(E,2),X=J[0],N=J[1],P=(0,M.useRef)(),le=(0,M.useState)(),K=g()(le,2),q=K[0],L=K[1],ie=(0,M.useState)([]),G=g()(ie,2),R=G[0],_=G[1],de=(0,v.useIntl)(),ee=(0,v.useAccess)(),re=[{title:(0,r.jsx)(v.FormattedMessage,{id:"pages.roles.name",defaultMessage:"\u540D\u79F0"}),dataIndex:"name",tip:"\u540D\u79F0",width:"75px",render:function(i,d){return(0,r.jsx)("a",{onClick:function(){L(d),N(!0)},children:i})}},{title:(0,r.jsx)(v.FormattedMessage,{id:"pages.roles.permissions",defaultMessage:"\u6743\u9650\u5217\u8868"}),dataIndex:"permissions",renderText:function(i){return i.map(function(d){return d.name}).join(", ")},hideInSearch:!0,hideInTable:!0},{title:(0,r.jsx)(v.FormattedMessage,{id:"pages.roles.users",defaultMessage:"\u7528\u6237\u5217\u8868"}),dataIndex:"users",renderText:function(i){return i.map(function(d){return d.username}).join(", ")},hideInSearch:!0},{title:(0,r.jsx)(v.FormattedMessage,{id:"pages.users.createTime",defaultMessage:"\u521B\u5EFA\u65F6\u95F4"}),hideInSearch:!0,dataIndex:"createdAt",valueType:"date"},{title:(0,r.jsx)(v.FormattedMessage,{id:"pages.roles.updatedTime",defaultMessage:"\u66F4\u65B0\u65F6\u95F4"}),hideInSearch:!0,hideInTable:!0,dataIndex:"updatedAt",valueType:"date"},{title:(0,r.jsx)(v.FormattedMessage,{id:"pages.searchTable.titleOption",defaultMessage:"\u64CD\u4F5C"}),dataIndex:"option",valueType:"option",fixed:"right",render:function(i,d){return[ee.canUpdateRole&&(0,r.jsx)("a",{onClick:function(){e(!0),L(d)},children:(0,r.jsx)(v.FormattedMessage,{id:"pages.searchTable.editting",defaultMessage:"\u7F16\u8F91"})},"update"),(0,r.jsx)("a",{onClick:function(){return H.Z.confirm({title:"\u786E\u8BA4\u5220\u9664\uFF1F",onOk:function(){var C=S()(c()().mark(function F(){var f,j;return c()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,Fe([d.id]);case 2:_([]),(f=P.current)===null||f===void 0||(j=f.reloadAndRest)===null||j===void 0||j.call(f);case 4:case"end":return x.stop()}},F)}));function m(){return C.apply(this,arguments)}return m}(),content:"\u786E\u8BA4\u5220\u9664\u5417\uFF1F",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88"})},children:(0,r.jsx)(v.FormattedMessage,{id:"pages.searchTable.delete",defaultMessage:"\u5220\u9664"})},"delete")]}}];return(0,r.jsxs)(ue._z,{children:[(0,r.jsx)(oe.Z,{headerTitle:de.formatMessage({id:"menu.auth.roles",defaultMessage:"\u89D2\u8272\u7BA1\u7406"}),actionRef:P,pagination:{defaultPageSize:10},rowKey:"id",search:{labelWidth:120},toolBarRender:function(){return[ee.canCreateRole&&(0,r.jsxs)(V.ZP,{type:"primary",onClick:function(){n(!0)},children:[(0,r.jsx)(ge.Z,{})," ",(0,r.jsx)(v.FormattedMessage,{id:"pages.searchTable.new",defaultMessage:"New"})]},"primary")]},request:function(){var p=S()(c()().mark(function i(d,h,C){return c()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.abrupt("return",(0,U.et)("/roles",d,h,C));case 1:case"end":return F.stop()}},i)}));return function(i,d,h){return p.apply(this,arguments)}}(),columns:re,rowSelection:{onChange:function(i,d){_(d)}}}),(R==null?void 0:R.length)>0&&(0,r.jsx)(Y.S,{extra:(0,r.jsxs)("div",{children:[(0,r.jsx)(v.FormattedMessage,{id:"pages.searchTable.chosen",defaultMessage:"Chosen"})," ",(0,r.jsx)("a",{style:{fontWeight:600},children:R.length})," ",(0,r.jsx)(v.FormattedMessage,{id:"pages.searchTable.item",defaultMessage:"\u9879"}),"\xA0\xA0"]}),children:(0,r.jsx)(V.ZP,{type:"primary",danger:!0,onClick:function(){return H.Z.confirm({title:"\u786E\u8BA4\u5220\u9664\uFF1F",onOk:function(){var i=S()(c()().mark(function h(){var C,m;return c()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,Fe(R==null?void 0:R.map(function(j){return j.id}));case 2:_([]),(C=P.current)===null||C===void 0||(m=C.reloadAndRest)===null||m===void 0||m.call(C);case 4:case"end":return f.stop()}},h)}));function d(){return i.apply(this,arguments)}return d}(),content:"\u786E\u8BA4\u5220\u9664\u5417\uFF1F",okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88"})},children:(0,r.jsx)(v.FormattedMessage,{id:"pages.searchTable.batchDeletion",defaultMessage:"Batch deletion"})})}),(0,r.jsx)(Ee,{open:l,onOpenChange:n,onFinish:function(){var p=S()(c()().mark(function i(d){var h;return c()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,Ue(d);case 2:h=m.sent,h&&(n(!1),P.current&&P.current.reload());case 4:case"end":return m.stop()}},i)}));return function(i){return p.apply(this,arguments)}}()}),(0,r.jsx)(Ze,{onSubmit:function(){var p=S()(c()().mark(function i(d){var h;return c()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,we(d);case 2:h=m.sent,h&&(e(!1),L(void 0),P.current&&P.current.reload());case 4:case"end":return m.stop()}},i)}));return function(i){return p.apply(this,arguments)}}(),onCancel:e,updateModalOpen:T,values:q||{}}),(0,r.jsx)($e,{open:X,currentRow:q,columns:re,onClose:function(){L(void 0),N(!1)}})]})},Be=Le}}]);
